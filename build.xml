<?xml version="1.0"?>

<project name="PCT" default="dist" basedir=".">
  
  <!-- Give user a chance to override without editing this file
       (and without typing -D each time it compiles it) -->
  <property file=".pct.properties"/>
  <property file="${user.home}/.pctrc"/>
  <property environment="env"/>
  
  <!-- Some directories definitions -->
  <property name="src.java" location="src/java"/>
  <property name="src.progress" location="src/progress"/>
  <property name="build" location="build"/>
  <property name="dist" location="lib"/>
  <property name="doc" location="javadoc"/>

  <taskdef name="jalopy" classname="de.hunsicker.jalopy.plugin.ant.AntPlugin">
    <classpath>
      <fileset dir="${env.JALOPY_HOME}/lib">
        <include name="*.jar" />
      </fileset>
    </classpath>
  </taskdef>

  <target name="init" description="Creates required directories">
    <mkdir dir="${build}"/>
    <mkdir dir="${dist}"/>
  </target>

  <target name="format" depends="compile" description="Formats source code">
    <jalopy fileformat="unix" encoding="iso8859-1" convention="jalopy.xml">
      <fileset dir="${src.java}">
        <include name="com/phenix/pct/**/*.java" />
      </fileset>
    </jalopy>
  </target>

  <target name="doc" description="Creates the API documentation">
    <mkdir dir="${doc}"/>
    <javadoc sourcepath="${src.java}" destdir="${doc}" author="true" doctitle="PCT" windowtitle="PCT API" locale="en" version="false" classpath="/usr/local/ant/lib/ant.jar">
      <packageset dir="${src.java}"/>
      <group title="PCT Core" packages="com.phenix.pct.*"/>
      <bottom>Copyright &#169; 2003 Apache Software Foundation. All Rights Reserved.</bottom>
    </javadoc>
  </target>
  
  <target name="compile" depends="init" description="Source compilation">
    <javac srcdir="${src.java}" destdir="${build}" includes="com/phenix/pct/*.java" classpath="/usr/local/ant/lib/ant.jar" debug="true"/>
  </target>

  <target name="jar" depends="compile" description="Generates JAR files">
    <jar jarfile="${dist}/PCT.jar" basedir="${build}" includes="com/phenix/pct/*.class"/>
  </target>
  
  <target name="dist" depends="jar" description="Generates zip archive">
    <tar destfile="pct.tar.gz" compression="gzip">
      <tarfileset prefix="pct" dir="." mode="644">
        <include name="lib/PCT.jar"/>
        <include name="src/progress/*.p"/>
        <include name="src/java/**/*.java"/>
	<include name="doc/*.html"/>
	<include name="doc/*.css"/>
	<include name="CHANGELOG"/>
      </tarfileset>
    </tar>
    <zip destfile="pct.zip">
      <zipfileset prefix="pct" dir="." filemode="644">
        <include name="lib/PCT.jar"/>
        <include name="src/progress/*.p"/>
        <include name="src/java/**/*.java"/>
	<include name="doc/*.html"/>
	<include name="doc/*.css"/>
	<include name="CHANGELOG"/>
      </zipfileset>
    </zip>
  </target>
  
  <target name="clean" description="Nettoyage">
    <delete dir="${build}"/>
    <delete dir="${dist}"/>
  </target>
  
</project>
