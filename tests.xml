<?xml version="1.0" encoding="utf-8"?>

<project name="PCT-Tests">

  <taskdef classname="net.bluecow.googlecode.ant.GoogleCodeUploadTask" name="gcupload"/>
  <property name="testdir" location="testbox" />

  <path id="test.run.cp">
    <pathelement location="classes" />
    <pathelement location="PCT-Tests-Deps.jar" />
  </path>

  <path id="testng.cp">
    <fileset dir="." includes="PCT-Tests-Deps.jar" />
  </path>

  <target name="prepare-test" >
    <delete dir="${testdir}" />
    <delete dir="test-output" />
    <delete dir="classes" />
    <delete file="emailable-report-${TESTENV}.html" />
    <delete file="testng-results-${TESTENV}.xml" />

    <mkdir dir="${testdir}" />
    <unzip src="pct-tests.zip" dest="${testdir}" />

    <mkdir dir="classes" />
    <unjar src="PCT-Tests.jar" dest="classes" />
  </target>

  <target name="test" depends="prepare-test">
    <mkdir dir="test-output" />
    <taskdef resource="testngtasks" classpathref="testng.cp" />
    <testng workingDir="${testdir}" outputdir="test-output" useDefaultListeners="true" groups="${GROUPS}" excludedgroups="${EXCLUDES}">
      <classfileset dir="classes" includes="**/*Test.class" />
      <classpath refid="test.run.cp" />
      <jvmarg line="-DDLC=&quot;${DLC}&quot;" />
    </testng>
    <copy file="test-output/emailable-report.html" tofile="emailable-report-${TESTENV}.html" />
    <copy file="test-output/testng-results.xml" tofile="testng-results-${TESTENV}.xml" />
  	
    <gcupload username="${GCUSER}" password="${GCPASSWORD}" projectname="pct" filename="test-output/emailable-report.html" targetfilename="TestNG-${TESTENV}.html" summary="TestNG report" labels="TestNG" />
  </target>


</project>