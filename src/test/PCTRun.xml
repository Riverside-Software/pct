<?xml version="1.0"?>

<project name="PCTRun-test" default="">

  <taskdef name="PCTRun" classname="com.phenix.pct.PCTRun" classpath="../../lib/PCT.jar"/>

  <property environment="env"/>
  
  <!-- Should throw BuildException : no procedure defined -->
  <target name="test1">
    <PCTRun/>
  </target>
   
   <!-- Simple case : displays 'Hello world' and exits properly -->
  <target name="test2">
    <echo file="sandbox/test.p">
      MESSAGE "Hello world!".
      RETURN "0".
    </echo>
    <PCTRun procedure="sandbox/test.p" dlcHome="${env.DLC}"/>
  </target>
  
  <!-- Simple case 2 : return value is 1 : Expect build exception -->
  <target name="test3">
    <echo file="sandbox/test.p">
      RETURN "1".
    </echo>
    <PCTRun procedure="sandbox/test.p" dlcHome="${env.DLC}"/>
  </target>
  
  <!-- Procedure doesn't exists : Expect build exception -->
  <target name="test4">
    <PCTRun procedure="sandbox/not_existing.p" dlcHome="${env.DLC}"/>	
  </target>
  
  <!-- Return value is non numeric : Expect build exception -->
  <target name="test5">
    <echo file="sandbox/test.p">
      RETURN "ABC".
    </echo>
  	<PCTRun procedure="sandbox/test.p" dlcHome="${env.DLC}"/>
  </target>
  
  <!-- Impossible to compile procedure : Expect build exception -->
  <target name="test6">
    <echo file="sandbox/test.p">
      En voila du code qui ne compile pas.
    </echo>
    <PCTRun procedure="sandbox/test.p" dlcHome="${env.DLC}"/>	
  </target>
  
  <!-- Test propath -->
  <target name="test7">
    <echo file="sandbox/test.p">
      RETURN "0".
    </echo>
    <PCTRun procedure="test.p" dlcHome="${env.DLC}">
      <propath>
        <pathelement location="sandbox"/>	
      </propath>	
    </PCTRun>
  </target>
  
  <!-- Test name containing ' and ~ -->
  <!-- See bug 837205 -->
  <target name="test8">
    <echo file="sandbox/wizz~~'~.p">
      RETURN "0".
    </echo>
    <PCTRun procedure="sandbox/wizz~~'~.p" dlcHome="${env.DLC}"/>
  </target>
  
  <!-- Test -param attribute -->
  <target name="test9init">
    <echo file="sandbox/test.p">
      MESSAGE "Hello" + SESSION:PARAMETER.
      RETURN "0".
    </echo>
  </target>
  <target name="test9">
    <PCTRun procedure="sandbox/test.p" dlcHome="${env.DLC}" parameter=" PCT"/>
  </target>
  <target name="test9bis">
    <PCTRun procedure="sandbox/test.p" dlcHome="${env.DLC}"/>
  </target>
  
  <!-- Test -yy attribute - Default is 1950 -->
  <target name="test10init">
    <echo file="sandbox/test.p">
      MESSAGE STRING(DATE("0101" + SESSION:PARAMETER), "99/99/9999").
      RETURN "0".
    </echo>
  </target>
  <target name="test10">
    <PCTRun procedure="sandbox/test.p" dlcHome="${env.DLC}" parameter="60" centuryYearOffset="1970"/>
  </target>
  <target name="test10bis">
    <PCTRun procedure="sandbox/test.p" dlcHome="${env.DLC}" parameter="60"/>
  </target>
  
</project>
