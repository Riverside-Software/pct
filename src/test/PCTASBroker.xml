<?xml version="1.0"?>
<project name="PCTASBroker-test" default="">
  <!-- $Revision: 453 $ -->

  <taskdef resource="PCT.properties" classpath="." />

  <property environment="env" />
  <property name="pct-propath" location="progress" />

  <!-- Missing parameters #1 -->
  <target name="failure1">
    <PCTASBroker name="test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}" />
  </target>

  <!-- Missing parameters #2 -->
  <target name="failure2">
    <PCTASBroker action="create" file="sandbox/ubroker.properties" dlcHome="${env.DLC}" />
  </target>

  <!-- Simplest test : we should just get the declaration... -->
  <target name="SimplestTest">
    <PCTASBroker action="create" name="Test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}" />
  </target>

  <!-- Testing UID none -->
  <target name="TestUidNone">
    <PCTASBroker action="create" name="Test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}" uid="none" />
  </target>

  <!-- Testing UID auto -->
  <target name="TestUidAuto">
    <PCTASBroker action="create" name="Test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}" uid="auto" />
  </target>

  <!-- Testing specific UID -->
  <target name="TestUid">
    <PCTASBroker action="create" name="Test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}" uid="3fb5744ad58ca1b0:239137:10a178402e4:-8000" />
  </target>

  <!-- Testing broker & server log attributes -->
  <target name="TestLogging">
    <PCTASBroker action="create" name="Test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}" brokerLogFile="broker.log" brokerLogLevel="4" serverLogFile="server.log" serverLogLevel="1" />
  </target>

  <!-- Testing appserver broker deletion -->
  <target name="TestApsvDelete">
    <PCTASBroker action="create" name="Test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}" />
    <PCTASBroker action="delete" name="Test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}" />
  </target>

  <!-- Testing appserver update -->
  <target name="TestApsvUpdate-Part1">
    <PCTASBroker action="create" name="Test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}" portNumber="12345" />
  </target>
  <target name="TestApsvUpdate-Part2">
    <PCTASBroker action="update" name="Test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}" portNumber="12346" />
  </target>

  <!-- Second create should throw BuildException -->
  <target name="TestDoubleCreate-Part1">
    <PCTASBroker action="create" name="Test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}" />
  </target>
  <target name="TestDoubleCreate-Part2">
    <PCTASBroker action="create" name="Test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}" />
  </target>

  <!-- Testing a few attributes : -->
  <target name="TestAttributes-1">
    <PCTASBroker action="create" name="Test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}" operatingMode="state-reset" workDir="sandbox" autoStart="true" initialPool="4" minPool="3" maxPool="5" />
  </target>

  <!-- Testing forbidden attributes of Server -->
  <target name="TestForbiddenAttributes-1">
    <PCTASBroker action="create" name="Test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}">
      <Server procedure="test.p" />
    </PCTASBroker>
  </target>
  <target name="TestForbiddenAttributes-2">
    <PCTASBroker action="create" name="Test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}">
      <Server graphicalMode="true" />
    </PCTASBroker>
  </target>
  <target name="TestForbiddenAttributes-3">
    <PCTASBroker action="create" name="Test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}">
      <Server debugPCT="true" />
    </PCTASBroker>
  </target>
  <target name="TestForbiddenAttributes-4">
    <PCTASBroker action="create" name="Test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}">
      <Server baseDir="." />
    </PCTASBroker>
  </target>

  <!-- Testing serverAttributes -->
  <target name="TestAttributes-2">
    <PCTASBroker action="create" name="Test" file="sandbox/ubroker.properties" dlcHome="${env.DLC}">
      <Server startupProc="startup.p" shutdownProc="shutdown.p" activateProc="activate.p" deactivateProc="deactivate.p" connectProc="connect.p" disconnectProc="disconnect.p"/>
    </PCTASBroker>
  </target>
  
</project>
