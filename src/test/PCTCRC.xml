<?xml version="1.0"?>

<project name="PCTCRC-test" default="">
  <!-- $Revision$ -->

  <taskdef resource="PCT.properties" classpath="." />

  <property environment="env" />

  <!-- Test prowin32 on Windows, _progres on everything else -->
  <property name="graph" value="false" />
  <condition property="graph" value="true">
    <os family="windows" />
  </condition>

  <!-- Should throw BuildException : no dest file -->
  <target name="test1">
    <PCTCRC graphicalMode="${graph}" dlcHome="${DLC}" />
  </target>

  <!-- No database connection : should throw BuildException -->
  <target name="test2">
    <PCTCRC graphicalMode="${graph}" destFile="sandbox/crc" dlcHome="${DLC}" />
  </target>
  <target name="test2post">
    <delete file="sandbox/crc" />
  </target>

  <!-- One database -->
  <target name="test3pre">
    <echo file="sandbox/schema.df">
      UPDATE DATABASE "?"
      
      ADD TABLE "Tab1"
        AREA "Schema Area"
        LABEL ""
        DESCRIPTION ""
        DUMP-NAME "Tab1"

      ADD FIELD "Fld1" OF "tab1" AS integer 
        FORMAT "9"
        INITIAL "0"
        LABEL "Fld1"
        POSITION 2
        SQL-WIDTH 4
        COLUMN-LABEL "Fld1"
        ORDER 10

      ADD INDEX "Tab1-PK" ON "tab1" 
        AREA "Schema Area"
        UNIQUE
        PRIMARY
        DESCRIPTION "Primary key"
        INDEX-FIELD "Fld1" ASCENDING 
    </echo>
    <PCTCreateBase dbName="test" destDir="sandbox" dlcHome="${DLC}" schemaFile="sandbox/schema.df" />
  </target>
  <target name="test3">
    <PCTCRC graphicalMode="${graph}" destFile="sandbox/crc" dlcHome="${DLC}">
      <PCTConnection dbName="test" dbDir="sandbox" singleUser="true" />
    </PCTCRC>
  </target>

  <!-- One database -->
  <target name="test4pre">
    <echo file="sandbox/schema.df">
      UPDATE DATABASE "?"
      
      ADD TABLE "Tab1"
        AREA "Schema Area"
        LABEL ""
        DESCRIPTION ""
        DUMP-NAME "Tab1"

      ADD FIELD "Fld1" OF "tab1" AS integer 
        FORMAT "9"
        INITIAL "0"
        LABEL "Fld1"
        POSITION 2
        SQL-WIDTH 4
        COLUMN-LABEL "Fld1"
        ORDER 10

      ADD INDEX "Tab1-PK" ON "tab1" 
        AREA "Schema Area"
        UNIQUE
        PRIMARY
        DESCRIPTION "Primary key"
        INDEX-FIELD "Fld1" ASCENDING 
    </echo>
    <PCTCreateBase dbName="test" destDir="sandbox" dlcHome="${DLC}" schemaFile="sandbox/schema.df" />
    <PCTCreateBase dbName="test2" destDir="sandbox" dlcHome="${DLC}" schemaFile="sandbox/schema.df" />
  </target>
  <target name="test4">
    <PCTCRC graphicalMode="${graph}" destFile="sandbox/crc" dlcHome="${DLC}">
      <PCTConnection dbName="test" dbDir="sandbox" singleUser="true" />
      <PCTConnection dbName="test2" dbDir="sandbox" singleUser="true" />
    </PCTCRC>
  </target>
</project>
