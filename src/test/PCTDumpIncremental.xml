<?xml version="1.0" encoding="utf-8"?>

<project name="PCTDumpIncremental-test" default="">

  <taskdef resource="PCT.properties" classpath="." />

  <property environment="env" />

  <target name="test1init">
    <echo file="sandbox/schema.df">
      UPDATE DATABASE "?"
      
      ADD TABLE "Tab1"
        AREA "Schema Area"
        LABEL ""
        DESCRIPTION ""
        DUMP-NAME "Tab1"

      ADD FIELD "Fld1" OF "tab1" AS integer 
        FORMAT "9"
        INITIAL "0"
        LABEL "Fld1"
        POSITION 2
        SQL-WIDTH 4
        COLUMN-LABEL "Fld1"
        ORDER 10

      ADD INDEX "Tab1-PK" ON "tab1" 
        AREA "Schema Area"
        UNIQUE
        PRIMARY
        DESCRIPTION "Primary key"
        INDEX-FIELD "Fld1" ASCENDING 
    </echo>
    <PCTCreateBase dbName="test" destDir="sandbox" dlcHome="${DLC}" schemaFile="sandbox/schema.df" />
    <PCTCreateBase dbName="test2" destDir="sandbox" dlcHome="${DLC}"  />
  </target>
  <target name="test1">
    <PCTDumpIncremental destFile="sandbox/incr.df" dlcHome="${DLC}" >
      <PCTConnection dbName="test" dbDir="sandbox" singleUser="true">
        <PCTAlias name="dictdb" />
      </PCTConnection>
      <PCTConnection dbName="test2" dbDir="sandbox" singleUser="true">
        <PCTAlias name="dictdb2" />
      </PCTConnection>
    </PCTDumpIncremental>
  </target>
  <target name="test1bis">
    <PCTLoadSchema srcFile="sandbox/incr.df" dlcHome="${DLC}" >
      <PCTConnection dbName="test2" dbDir="sandbox" singleUser="true" />
    </PCTLoadSchema>
    <echo file="sandbox/test1.p">
      CREATE Tab1.
      ASSIGN Tab1.Fld1 = 0.
    </echo>
    <PCTCompile destDir="sandbox" dlcHome="${DLC}" >
      <fileset dir="sandbox">
        <include name="test1.p" />
      </fileset>
      <PCTConnection dbName="test2" dbDir="sandbox" singleUser="true" />
    </PCTCompile>
  </target>

  <target name="test2init">
    <echo file="sandbox/schema.df">
      UPDATE DATABASE "?"
      
      ADD TABLE "Tab1"
        AREA "Schema Area"
        LABEL ""
        DESCRIPTION ""
        DUMP-NAME "Tab1"

      ADD FIELD "Fld1" OF "tab1" AS integer 
        FORMAT "9"
        INITIAL "0"
        LABEL "Fld1"
        POSITION 2
        SQL-WIDTH 4
        COLUMN-LABEL "Fld1"
        ORDER 10

      ADD INDEX "Tab1-PK" ON "tab1" 
        AREA "Schema Area"
        UNIQUE
        PRIMARY
        DESCRIPTION "Primary key"
        INDEX-FIELD "Fld1" ASCENDING 
    </echo>
    <echo file="sandbox/schema2.df">
      UPDATE DATABASE "?"
      
      ADD INDEX "Tab1-Idx1" ON "Tab1"
        AREA "Schema Area"
        UNIQUE
        DESCRIPTION "Index number 1"
        INDEX-FIELD "Fld1" DESCENDING
    </echo>
    <PCTCreateBase dbName="test" destDir="sandbox" dlcHome="${DLC}" schemaFile="sandbox/schema.df,sandbox/schema2.df"  />
    <PCTCreateBase dbName="test2" destDir="sandbox" dlcHome="${DLC}" schemaFile="sandbox/schema.df"  />
  </target>
  <target name="test2">
    <PCTDumpIncremental destFile="sandbox/incr1.df" dlcHome="${DLC}"  activeIndexes="true">
      <PCTConnection dbName="test" dbDir="sandbox" singleUser="true">
        <PCTAlias name="dictdb" />
      </PCTConnection>
      <PCTConnection dbName="test2" dbDir="sandbox" singleUser="true">
        <PCTAlias name="dictdb2" />
      </PCTConnection>
    </PCTDumpIncremental>
    <PCTDumpIncremental destFile="sandbox/incr2.df" dlcHome="${DLC}"  activeIndexes="false">
      <PCTConnection dbName="test" dbDir="sandbox" singleUser="true">
        <PCTAlias name="dictdb" />
      </PCTConnection>
      <PCTConnection dbName="test2" dbDir="sandbox" singleUser="true">
        <PCTAlias name="dictdb2" />
      </PCTConnection>
    </PCTDumpIncremental>
  </target>

  <target name="test3init">
    <echo file="sandbox/schema.df">
      UPDATE DATABASE "?"
      
      ADD TABLE "Tab1"
        AREA "Schema Area"
        LABEL ""
        DESCRIPTION ""
        DUMP-NAME "Tab1"

      ADD FIELD "Fld1" OF "tab1" AS integer 
        FORMAT "9"
        INITIAL "0"
        LABEL "Fld1"
        POSITION 2
        SQL-WIDTH 4
        COLUMN-LABEL "Fld1"
        ORDER 10

      ADD INDEX "Tab1-PK" ON "tab1" 
        AREA "Schema Area"
        UNIQUE
        PRIMARY
        DESCRIPTION "Primary key"
        INDEX-FIELD "Fld1" ASCENDING 
    </echo>
    <echo file="sandbox/schema2.df">
      UPDATE DATABASE "?"
      
      ADD FIELD "Fld2" OF "tab1" AS integer 
        FORMAT "9"
        INITIAL "0"
        LABEL "Fld1"
        POSITION 3
        SQL-WIDTH 4
        COLUMN-LABEL ""
        ORDER 20
    </echo>
    <PCTCreateBase dbName="test" destDir="sandbox" dlcHome="${DLC}" schemaFile="sandbox/schema.df,sandbox/schema2.df"  />
    <PCTCreateBase dbName="test2" destDir="sandbox" dlcHome="${DLC}" schemaFile="sandbox/schema.df"  />
  </target>
  <target name="test3">
    <PCTDumpIncremental destFile="sandbox/incr1.df" dlcHome="${DLC}"  codepage="iso8859-1">
      <PCTConnection dbName="test" dbDir="sandbox" singleUser="true">
        <PCTAlias name="dictdb" />
      </PCTConnection>
      <PCTConnection dbName="test2" dbDir="sandbox" singleUser="true">
        <PCTAlias name="dictdb2" />
      </PCTConnection>
    </PCTDumpIncremental>
    <PCTDumpIncremental destFile="sandbox/incr2.df" dlcHome="${DLC}"  codepage="utf-8">
      <PCTConnection dbName="test" dbDir="sandbox" singleUser="true">
        <PCTAlias name="dictdb" />
      </PCTConnection>
      <PCTConnection dbName="test2" dbDir="sandbox" singleUser="true">
        <PCTAlias name="dictdb2" />
      </PCTConnection>
    </PCTDumpIncremental>
  </target>

  <target name="test4init">
    <echo file="sandbox/schema.df">
      UPDATE DATABASE "?"
      
      ADD TABLE "Tab1"
        AREA "Schema Area"
        LABEL ""
        DESCRIPTION ""
        DUMP-NAME "Tab1"

      ADD FIELD "Fld1" OF "tab1" AS integer 
        FORMAT "9"
        INITIAL "0"
        LABEL "Fld1"
        POSITION 2
        SQL-WIDTH 4
        COLUMN-LABEL "Fld1"
        ORDER 10

      ADD FIELD "Fld2" OF "tab1" AS integer 
        FORMAT "9"
        INITIAL "0"
        LABEL "Fld2"
        POSITION 3
        SQL-WIDTH 4
        COLUMN-LABEL "Fld2"
        ORDER 20

      ADD INDEX "Tab1-PK" ON "tab1" 
        AREA "Schema Area"
        UNIQUE
        PRIMARY
        DESCRIPTION "Primary key"
        INDEX-FIELD "Fld1" ASCENDING 
    </echo>
    <echo file="sandbox/schema2.df">
      ADD TABLE "Tab1"
        AREA "Schema Area"
        LABEL ""
        DESCRIPTION ""
        DUMP-NAME "Tab1"

      ADD FIELD "Fld1" OF "tab1" AS integer 
        FORMAT "9"
        INITIAL "0"
        LABEL "Fld1"
        POSITION 2
        SQL-WIDTH 4
        COLUMN-LABEL "Fld1"
        ORDER 10

      ADD FIELD "Fld3" OF "tab1" AS integer 
        FORMAT "9"
        INITIAL "0"
        LABEL "Fld3"
        POSITION 3
        SQL-WIDTH 4
        COLUMN-LABEL "Fld3"
        ORDER 20

      ADD INDEX "Tab1-PK" ON "tab1" 
        AREA "Schema Area"
        UNIQUE
        PRIMARY
        DESCRIPTION "Primary key"
        INDEX-FIELD "Fld1" ASCENDING 
    </echo>
    <echo file="sandbox/rename.txt" message="F,tab1,Fld3,Fld2${line.separator}" />
    <PCTCreateBase dbName="test" destDir="sandbox" dlcHome="${DLC}" schemaFile="sandbox/schema.df"  />
    <PCTCreateBase dbName="test2" destDir="sandbox" dlcHome="${DLC}" schemaFile="sandbox/schema2.df"  />
  </target>
  <target name="test4">
    <PCTDumpIncremental destFile="sandbox/incr1.df" dlcHome="${DLC}" >
      <PCTConnection dbName="test" dbDir="sandbox" singleUser="true">
        <PCTAlias name="dictdb" />
      </PCTConnection>
      <PCTConnection dbName="test2" dbDir="sandbox" singleUser="true">
        <PCTAlias name="dictdb2" />
      </PCTConnection>
    </PCTDumpIncremental>
    <PCTDumpIncremental destFile="sandbox/incr2.df" dlcHome="${DLC}"  renameFile="sandbox/rename.txt">
      <PCTConnection dbName="test" dbDir="sandbox" singleUser="true">
        <PCTAlias name="dictdb" />
      </PCTConnection>
      <PCTConnection dbName="test2" dbDir="sandbox" singleUser="true">
        <PCTAlias name="dictdb2" />
      </PCTConnection>
    </PCTDumpIncremental>
  </target>

</project>